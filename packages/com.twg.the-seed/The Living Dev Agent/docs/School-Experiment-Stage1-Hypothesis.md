# School Experiment - Stage 1: Hypothesis Extraction Tool

## Overview

The **HypothesisExtractor** is a Unity Editor tool that implements Stage 1 of the 'school' experiment workflow. It processes the inventory.json file generated by Stage 0 and creates hypothesis drafts for each faculty surface, generating capability assertions and improvement targets based on Unity context and asset metadata.

## Features

- **Unity 6 Compatible**: Operates within Unity 6 (2023+) EditorContext using Unity APIs
- **Inventory Processing**: Loads and processes inventory.json from Stage 0
- **Context-Aware Analysis**: Utilizes Unity asset metadata and tags for intelligent hypothesis generation
- **Hypothesis Classification**: Generates both "CapabilityAssertion" and "ImprovementTarget" hypotheses
- **Interactive UI**: User-friendly Unity Editor window interface with real-time progress feedback
- **Structured Output**: Comprehensive JSON output with metadata and confidence scoring

## Usage

### Prerequisites

1. **Unity 6+**: Requires Unity 6 (2023+) or later
2. **Stage 0 Complete**: Run the Inventory Collector first (Tools > School > Generate Inventory)
3. **Inventory File**: Ensure `assets/experiments/school/inventory.json` exists

### Running Stage 1

1. **Open Unity Editor**
2. **Navigate to Menu**: `Tools > School > Extract Hypotheses`
3. **Load Inventory**: Click "üîÑ Load Inventory" to load the Stage 0 results
4. **Extract Hypotheses**: Click "üöÄ Extract Hypotheses" to begin processing
5. **Review Results**: Examine the generated hypotheses in the results section
6. **Access Output**: Find the output at `assets/experiments/school/hypothesis_drafts.json`

### Workflow Integration

```
Stage 0: Inventory Collection
    ‚Üì (inventory.json)
Stage 1: Hypothesis Extraction ‚Üê YOU ARE HERE
    ‚Üì (hypothesis_drafts.json)
Stage 2: Hypothesis Validation (Future)
    ‚Üì (validated_hypotheses.json)
Stage 3: Implementation Planning (Future)
```

## Hypothesis Types

The tool generates two primary types of hypotheses:

### Capability Assertions
- **Purpose**: Identify what the faculty surface can do or be enhanced to do
- **Examples**: 
  - Editor Tool Enhancement Potential
  - Data Structure Extensibility
  - Prefab Variant Creation Potential
  - Shader Variant Creation Potential

### Improvement Targets
- **Purpose**: Identify areas where the faculty surface can be optimized or improved
- **Examples**:
  - Component Performance Optimization
  - Large Script Refactoring Opportunity
  - Complex Prefab Simplification
  - Texture Compression Optimization

## Faculty Surface Analysis

The tool analyzes different types of Unity assets and generates context-specific hypotheses:

### Scripts (.cs files)
- **EditorTool Analysis**: Identifies workflow automation potential
- **Component Analysis**: Assesses performance optimization opportunities
- **DataAsset Analysis**: Evaluates extensibility and validation potential
- **File Size Analysis**: Detects refactoring opportunities for large scripts

### Prefabs (.prefab files)
- **Component Count Analysis**: Evaluates complexity and simplification potential
- **Variant Creation**: Identifies reusability opportunities
- **Performance Assessment**: Analyzes optimization potential

### Materials (.mat files)
- **Shader Optimization**: Platform-specific performance improvements
- **Rendering Pipeline**: Compatibility and efficiency analysis

### Textures
- **Compression Analysis**: Memory and performance optimization
- **Platform Optimization**: Target-specific compression settings

### Shaders (.shader files)
- **Feature Extension**: Variant creation and enhancement potential
- **Performance Optimization**: Rendering efficiency improvements

### Scenes (.unity files)
- **Loading Optimization**: Performance and memory improvements
- **Structure Analysis**: Organization and efficiency assessment

### Audio Assets
- **Compression Optimization**: File size and quality balance
- **Memory Usage**: Runtime performance improvements

### Mesh Assets
- **Polygon Optimization**: Performance and memory improvements
- **LOD Analysis**: Level-of-detail optimization potential

## JSON Output Structure

```json
{
  "Timestamp": "2024-09-06T01:29:05.966548Z",
  "Status": "draft",
  "UnityVersion": "6000.2.0f1",
  "ProjectPath": "/path/to/project/Assets",
  "SourceInventoryHash": "d0865a96189ad5c3",
  "Hypotheses": [
    {
      "Id": "uuid-string",
      "FacultySurfacePath": "Assets/Path/To/Asset.cs",
      "FacultySurfaceType": "Script",
      "Type": "CapabilityAssertion",
      "Title": "Editor Tool Enhancement Potential",
      "Description": "This editor tool can be enhanced with additional workflow automation and UI improvements",
      "Evidence": "Script tagged as EditorTool, file size: 15420 bytes",
      "Priority": "Medium",
      "Confidence": 0.7,
      "EstimatedEffort": "2-4 hours",
      "PotentialImpact": "Improved developer workflow efficiency"
    }
  ]
}
```

### Field Descriptions

- **Timestamp**: UTC timestamp of hypothesis generation
- **Status**: Always "draft" for Stage 1 output
- **UnityVersion**: Unity Editor version used for analysis
- **ProjectPath**: Absolute path to the Unity project Assets folder
- **SourceInventoryHash**: Hash from the source inventory.json for traceability
- **Hypotheses**: Array of individual hypothesis objects

#### Hypothesis Fields

- **Id**: Unique identifier (GUID) for the hypothesis
- **FacultySurfacePath**: Relative path to the analyzed asset
- **FacultySurfaceType**: Type of faculty surface (Script, Prefab, etc.)
- **Type**: Hypothesis classification (CapabilityAssertion or ImprovementTarget)
- **Title**: Brief, descriptive title of the hypothesis
- **Description**: Detailed explanation of the hypothesis
- **Evidence**: Supporting evidence or reasoning for the hypothesis
- **Priority**: Relative priority (Low, Medium, High)
- **Confidence**: Numerical confidence score (0.0 to 1.0)
- **EstimatedEffort**: Time estimate for implementing the hypothesis
- **PotentialImpact**: Expected benefits of implementing the hypothesis

## Integration with Unity APIs

The tool leverages Unity's built-in APIs for robust integration:

- **EditorWindow**: Extends Unity's EditorWindow for UI
- **MenuItem**: Accessible via Unity's top menu bar
- **JsonUtility**: Uses Unity's built-in JSON serialization
- **AssetDatabase**: References Unity's asset management system
- **Application**: Accesses Unity version and project path information
- **Task/Async**: Non-blocking operations for better user experience

## Integration with GitHub (Future Enhancement)

For future LLM-based hypothesis generation, the tool can be extended with:

### UnityWebRequest Integration
```csharp
using UnityEngine.Networking;

// Safe web API calls from Unity Editor
public async Task<string> CallGitHubCopilotAPI(string prompt)
{
    using (var request = UnityWebRequest.Post(apiUrl, prompt))
    {
        request.SetRequestHeader("Authorization", "Bearer " + token);
        await request.SendWebRequest();
        
        if (request.result == UnityWebRequest.Result.Success)
        {
            return request.downloadHandler.text;
        }
        return null;
    }
}
```

### Async Integration Pattern
```csharp
// Non-blocking API calls
private async Task<List<Hypothesis>> GenerateEnhancedHypotheses(FacultySurface surface)
{
    var basicHypotheses = await GenerateBasicHypotheses(surface);
    
    // Optional LLM enhancement
    if (useAIEnhancement)
    {
        var enhancedHypotheses = await EnhanceWithAI(basicHypotheses, surface);
        return enhancedHypotheses;
    }
    
    return basicHypotheses;
}
```

### Security Considerations
- **API Key Management**: Store GitHub tokens securely, never in source code
- **Network Validation**: Validate all network responses
- **Fallback Logic**: Always provide offline hypothesis generation
- **Rate Limiting**: Respect GitHub API rate limits
- **Error Handling**: Graceful degradation when API unavailable

## File Structure

```
Assets/TWG/TLDA/Tools/School/Editor/
‚îú‚îÄ‚îÄ InventoryCollector.cs          # Stage 0 - Inventory collection
‚îú‚îÄ‚îÄ InventoryCollector.cs.meta     # Unity metadata
‚îú‚îÄ‚îÄ HypothesisExtractor.cs         # Stage 1 - Hypothesis extraction
‚îî‚îÄ‚îÄ HypothesisExtractor.cs.meta    # Unity metadata

assets/experiments/school/
‚îú‚îÄ‚îÄ inventory.json                 # Stage 0 output (input for Stage 1)
‚îî‚îÄ‚îÄ hypothesis_drafts.json         # Stage 1 output
```

## Implementation Details

The tool follows Unity Editor best practices:

- **EditorWindow Pattern**: Consistent with Unity Editor UI conventions
- **MenuItem Integration**: Standard Unity menu system integration
- **Async/Await Operations**: Non-blocking processing for large projects
- **Progress Feedback**: Real-time progress updates during processing
- **Error Handling**: Comprehensive error handling with user feedback
- **Unity API Usage**: Leverages built-in Unity systems for reliability

### Code Architecture

```
HypothesisExtractor (EditorWindow)
‚îú‚îÄ‚îÄ UI Drawing Methods
‚îÇ   ‚îú‚îÄ‚îÄ DrawHeader()
‚îÇ   ‚îú‚îÄ‚îÄ DrawInventorySection()
‚îÇ   ‚îú‚îÄ‚îÄ DrawExtractionSection()
‚îÇ   ‚îú‚îÄ‚îÄ DrawResultsSection()
‚îÇ   ‚îî‚îÄ‚îÄ DrawOutputSection()
‚îú‚îÄ‚îÄ Core Processing
‚îÇ   ‚îú‚îÄ‚îÄ LoadInventory()
‚îÇ   ‚îú‚îÄ‚îÄ PerformHypothesisExtraction()
‚îÇ   ‚îî‚îÄ‚îÄ ExtractHypothesesFromSurfaces()
‚îú‚îÄ‚îÄ Hypothesis Generation
‚îÇ   ‚îú‚îÄ‚îÄ GenerateScriptHypotheses()
‚îÇ   ‚îú‚îÄ‚îÄ GeneratePrefabHypotheses()
‚îÇ   ‚îú‚îÄ‚îÄ GenerateMaterialHypotheses()
‚îÇ   ‚îî‚îÄ‚îÄ [Other asset type generators]
‚îî‚îÄ‚îÄ Data Management
    ‚îî‚îÄ‚îÄ SaveHypothesesJson()
```

## Performance

- **Processing Speed**: Optimized for large Unity projects with hundreds of assets
- **Memory Efficient**: Streams hypothesis generation to minimize memory usage
- **Progress Feedback**: Real-time progress updates prevent UI freezing
- **Non-blocking**: Async operations maintain Unity Editor responsiveness

## Platform Compatibility

- **Unity 6+**: Requires Unity 6 (2023+) or later
- **Editor Only**: Tool runs exclusively in Unity Editor context
- **Cross-Platform**: Works on Windows, macOS, and Linux Unity installations

## Troubleshooting

### Common Issues

1. **"Inventory file not found"**: Run Stage 0 (Generate Inventory) first
2. **"No inventory loaded"**: Click "Load Inventory" before extracting hypotheses
3. **Extraction appears frozen**: Check Unity Console for progress updates
4. **Large project processing**: Allow extra time for projects with many assets
5. **Permission errors**: Ensure write access to output directory

### Debug Information

The tool logs detailed information to Unity Console:
- Inventory loading progress
- Hypothesis generation statistics
- Processing progress updates
- Error messages with specific details
- Completion confirmation with summary

## Development

The tool is designed for extension and customization:

- **Hypothesis Generators**: Add new asset-specific hypothesis generators
- **Analysis Logic**: Enhance asset analysis algorithms
- **Output Format**: Modify JSON structure in data classes
- **UI Elements**: Enhance EditorWindow interface
- **API Integration**: Add external service integration for enhanced analysis

## Next Steps (Future Stages)

- **Stage 2**: Hypothesis Validation - Verify and score generated hypotheses
- **Stage 3**: Implementation Planning - Create actionable development plans
- **Stage 4**: Execution Tracking - Monitor implementation progress
- **Stage 5**: Impact Assessment - Measure results and learning outcomes

## License

This tool is part of the TWG-TLDA project and follows the project's licensing terms.