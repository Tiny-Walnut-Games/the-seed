# 🔄 Migration Guide to v1.0

## Overview

This comprehensive migration guide helps users upgrade from earlier versions of the Living Dev Agent to v1.0. The guide covers breaking changes, migration paths, and best practices for a smooth transition.

## Pre-Migration Assessment

### Version Compatibility Check

**Supported Upgrade Paths:**
- ✅ v0.8.x → v1.0 (Direct upgrade supported)
- ✅ v0.7.x → v1.0 (Direct upgrade with warnings)
- ⚠️ v0.6.x → v1.0 (Requires intermediate steps)
- ❌ v0.5.x and earlier → v1.0 (Manual migration required)

### Check Your Current Version
```bash
# Check current LDA version
python3 src/SymbolicLinter/symbolic_linter.py --version

# Check Unity plugin version (if applicable)
grep "version" Assets/Plugins/TLDA/package.json
```

### Backup Your Data
```bash
# Create backup of current installation
tar -czf lda-backup-$(date +%Y%m%d).tar.gz \
  TLDL/ docs/ scripts/ src/ \
  .agent-profile.yaml living-dev-agent.yaml

# Backup Unity plugin data (if applicable)
tar -czf unity-plugin-backup-$(date +%Y%m%d).tar.gz \
  Assets/Plugins/TLDA/ ProjectSettings/
```

## Breaking Changes in v1.0

### 1. TLDL Entry Format Changes

**What Changed:**
- Stricter metadata validation requirements
- New required fields: `entry_id`, `author`, `context`, `summary`
- Standardized section naming conventions

**Impact:**
- Existing TLDL entries may fail validation
- Chronicle Keeper automation requires updated entries

**Migration Action Required:**
```bash
# Run migration script for TLDL entries
python3 scripts/migrate_tldl_to_v1.py --backup --fix-metadata

# Validate all entries after migration
python3 src/SymbolicLinter/validate_docs.py --tldl-path TLDL/entries/
```

### 2. Plugin API Changes

**What Changed:**
- Plugin interface now requires explicit API version declaration
- New permission system for plugin security
- Updated event schema with breaking changes

**Impact:**
- Custom plugins require updates to implement new interface
- Plugin configurations need permission declarations

**Migration Action Required:**
```python
# Update plugin class (example)
class MyPlugin(BaseLDAPlugin):
    @property
    def api_version(self) -> str:
        return "1.0.0"  # Add this required property
    
    @property
    def permissions(self) -> List[str]:
        return ["file_system_read"]  # Declare required permissions
```

### 3. Configuration File Changes

**What Changed:**
- `.agent-profile.yaml` format updated with new fields
- `living-dev-agent.yaml` includes new security settings
- Deprecated configuration options removed

**Impact:**
- Configuration files may not load with legacy format
- Some features may be disabled until configuration updated

**Migration Action Required:**
```bash
# Backup current configuration
cp .agent-profile.yaml .agent-profile.yaml.backup

# Run configuration migration
python3 scripts/migrate_config_to_v1.py --validate
```

### 4. Unity Plugin Restructure

**What Changed:**
- Plugin moved to `Assets/Plugins/TLDA/` directory structure
- Assembly definition files required for proper compilation
- Package.json format updated for Unity Package Manager

**Impact:**
- Existing Unity installations require directory restructure
- Custom modifications to plugin may be lost

**Migration Action Required:**
```bash
# Run Unity plugin migration
cd Assets/
python3 ../scripts/migrate_unity_plugin_to_v1.py --backup
```

## Migration Process

### Step 1: Environment Preparation

#### Update System Dependencies
```bash
# Update Python dependencies
pip install -r scripts/requirements.txt --upgrade

# Ensure Python 3.11+ is available
python3 --version  # Should be 3.11.0 or higher

# Update Git configuration if needed
git config --global user.name "Your Name"
git config --global user.email "your.email@example.com"
```

#### Validate Current Installation
```bash
# Run pre-migration validation
python3 scripts/validate_pre_migration.py --verbose

# Check for conflicts
python3 scripts/check_migration_conflicts.py
```

### Step 2: Core System Migration

#### Download v1.0 Release
```bash
# Option 1: Git upgrade (recommended)
git fetch origin
git checkout v1.0.0

# Option 2: Fresh installation with data migration
# Download v1.0 package and extract to new directory
```

#### Run Core Migration Scripts
```bash
# Execute automatic migration
python3 scripts/migrate_to_v1.py \
  --backup \
  --validate \
  --fix-tldl \
  --update-config \
  --preserve-data

# This script will:
# 1. Backup current installation
# 2. Migrate TLDL entries to new format
# 3. Update configuration files
# 4. Preserve custom modifications where possible
# 5. Validate migrated components
```

### Step 3: Unity Plugin Migration (if applicable)

#### Automatic Unity Migration
```bash
# Run Unity-specific migration
python3 scripts/migrate_unity_to_v1.py \
  --project-path /path/to/unity/project \
  --backup \
  --preserve-settings

# Manual verification steps
# 1. Open Unity project
# 2. Check for compilation errors
# 3. Verify TLDL wizard functionality
# 4. Test plugin menu items
```

#### Manual Unity Migration (fallback)
If automatic migration fails:

1. **Backup existing plugin:**
   ```bash
   mv Assets/Plugins/LivingDevAgent Assets/Plugins/LivingDevAgent.backup
   ```

2. **Extract new plugin structure:**
   ```bash
   cp -r new-installation/Assets/Plugins/TLDA Assets/Plugins/
   ```

3. **Restore custom settings:**
   - Copy custom configurations from backup
   - Update assembly references if modified
   - Reapply any custom modifications

### Step 4: Configuration Migration

#### Automatic Configuration Update
```bash
# Update agent profile
python3 scripts/migrate_config.py \
  --agent-profile .agent-profile.yaml \
  --output .agent-profile.yaml.new \
  --validate

# Update main configuration
python3 scripts/migrate_config.py \
  --living-dev living-dev-agent.yaml \
  --output living-dev-agent.yaml.new \
  --validate

# Replace files after validation
mv .agent-profile.yaml.new .agent-profile.yaml
mv living-dev-agent.yaml.new living-dev-agent.yaml
```

#### Manual Configuration Updates
Key changes to apply manually:

```yaml
# .agent-profile.yaml - Add new v1.0 fields
version: "1.0.0"
api_contracts:
  bridge_version: "1.0.0"
  plugin_version: "1.0.0"
security:
  enable_validation: true
  require_signatures: true

# living-dev-agent.yaml - Update security settings
security:
  dependency_scanning: true
  secret_scanning: true
  static_analysis: true
permissions:
  file_system: "controlled"
  network_access: "limited"
```

### Step 5: TLDL Entry Migration

#### Bulk TLDL Migration
```bash
# Migrate all TLDL entries
python3 scripts/bulk_migrate_tldl.py \
  --input-dir TLDL/entries/ \
  --output-dir TLDL/entries.migrated/ \
  --fix-metadata \
  --add-missing-fields \
  --validate

# Backup original and replace
mv TLDL/entries TLDL/entries.backup
mv TLDL/entries.migrated TLDL/entries
```

#### Individual Entry Migration
For entries requiring manual attention:

```bash
# Get list of problematic entries
python3 src/SymbolicLinter/validate_docs.py \
  --tldl-path TLDL/entries/ \
  --report-format json > validation_issues.json

# Fix individual entries
python3 scripts/fix_tldl_entry.py \
  --entry TLDL/entries/problematic-entry.md \
  --auto-fix \
  --validate
```

## Post-Migration Validation

### System Health Check
```bash
# Run comprehensive validation
python3 scripts/post_migration_validation.py --comprehensive

# This checks:
# - All validation tools working
# - TLDL entries compliant
# - Plugin system functional
# - Configuration valid
# - Unity integration (if applicable)
```

### Performance Validation
```bash
# Verify performance targets met
python3 tests/test_performance.py --benchmark

# Expected results:
# - TLDL validation: <60ms
# - Symbolic linting: <123ms
# - Debug overlay: <56ms
```

### Feature Validation
```bash
# Test all major features
python3 tests/test_migration_features.py

# Test Unity plugin (if applicable)
# Open Unity and run: Tools > Living Dev Agent > Test Installation
```

## Troubleshooting Common Issues

### Issue 1: TLDL Validation Failures

**Symptoms:**
- Multiple validation errors after migration
- Missing metadata fields

**Solution:**
```bash
# Use the TLDL repair tool
python3 scripts/repair_tldl_entries.py \
  --auto-fix \
  --add-template-fields \
  --preserve-content

# Manually fix entries that can't be auto-repaired
python3 scripts/list_manual_fix_required.py
```

### Issue 2: Unity Plugin Compilation Errors

**Symptoms:**
- Compilation errors in Unity console
- Missing assembly references

**Solution:**
```bash
# Regenerate assembly definitions
python3 scripts/regenerate_unity_assemblies.py \
  --project-path /path/to/unity/project

# Or manually:
# 1. Delete existing .asmdef files
# 2. Reimport plugin
# 3. Create new assembly definitions
```

### Issue 3: Configuration Loading Errors

**Symptoms:**
- Agent profile fails to load
- Missing configuration sections

**Solution:**
```bash
# Reset to default configuration with migration
python3 scripts/reset_config_with_migration.py \
  --from-backup .agent-profile.yaml.backup \
  --merge-custom-settings

# Validate configuration
python3 scripts/validate_config.py --verbose
```

### Issue 4: Plugin Compatibility Issues

**Symptoms:**
- Custom plugins fail to load
- API version mismatch errors

**Solution:**
```python
# Update plugin to v1.0 API
# 1. Add required properties:
@property
def api_version(self) -> str:
    return "1.0.0"

@property
def permissions(self) -> List[str]:
    return ["file_system_read", "network_access"]

# 2. Update event handling:
def process_event(self, event: 'PluginEvent') -> 'PluginResult':
    # Handle new event schema
    pass
```

## Rollback Procedures

### If Migration Fails

#### Option 1: Restore from Backup
```bash
# Stop all LDA processes
pkill -f "living-dev-agent"

# Restore from backup
tar -xzf lda-backup-$(date +%Y%m%d).tar.gz

# Restart with previous version
python3 scripts/init_agent_context.sh
```

#### Option 2: Selective Rollback
```bash
# Rollback specific components only
git checkout HEAD~1 -- TLDL/entries/  # Rollback TLDL entries only
git checkout HEAD~1 -- .agent-profile.yaml  # Rollback configuration only
```

### Validate Rollback
```bash
# Ensure system works after rollback
python3 src/SymbolicLinter/validate_docs.py --tldl-path TLDL/entries/
python3 src/SymbolicLinter/symbolic_linter.py --path src/
```

## Best Practices for Migration

### Before Migration
1. **Test in Development Environment**: Always test migration process in non-production environment first
2. **Read Release Notes**: Review all v1.0 release notes and breaking changes
3. **Update Dependencies**: Ensure all system dependencies are up to date
4. **Backup Everything**: Create comprehensive backups of all data and configurations

### During Migration
1. **Follow Steps Sequentially**: Don't skip migration steps or run them out of order
2. **Validate Each Step**: Run validation after each major migration step
3. **Monitor Resources**: Watch system resources during bulk operations
4. **Document Issues**: Keep notes on any issues encountered for future reference

### After Migration
1. **Extended Testing**: Run system for at least 48 hours before considering migration complete
2. **Monitor Performance**: Watch for any performance regressions
3. **Update Documentation**: Update any custom documentation to reflect v1.0 changes
4. **Train Users**: Ensure all team members understand any workflow changes

## Getting Help

### Migration Support Resources
- **Documentation**: Complete migration documentation at `docs/migration/`
- **Community Support**: GitHub Discussions for migration questions
- **Issue Tracking**: GitHub Issues for migration bugs
- **Professional Support**: Contact support@tinywalnutgames.com for enterprise migration assistance

### Common Migration Questions

**Q: How long does migration typically take?**
A: Small installations (< 100 TLDL entries): 15-30 minutes
   Large installations (> 500 TLDL entries): 1-2 hours
   Unity projects: Additional 30 minutes

**Q: Can I migrate gradually?**
A: No, v1.0 migration must be completed as a single operation due to API dependencies.

**Q: What if I have custom modifications?**
A: Migration scripts preserve most customizations, but manual review may be required for extensive modifications.

**Q: Is there a rollback time limit?**
A: No time limit, but we recommend completing migration validation within 48 hours.

This migration guide ensures a smooth transition to v1.0 while preserving data integrity and system functionality. Follow the steps carefully and don't hesitate to seek help if issues arise during the migration process.